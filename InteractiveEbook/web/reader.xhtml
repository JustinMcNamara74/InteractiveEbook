<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html">
    <h:head>
        <title>WheeReader - 4J Interactive</title>
        
        <link rel="stylesheet" type="text/css" href="css/chaptertext.css" />
    </h:head>
    <h:body style="padding-top: 60px;">
        <ui:insert name="header" >
            <ui:include src="/template/navbar.xhtml" />
	</ui:insert>
        
        <table width="100%" height="100%">
            <tr height="100%">
                <td width="25%">
                    <div id="chapterFrame" align="left" style="overflow: auto;">
                        <b:panel look="primary">
                            <f:facet name="heading">Chapters</f:facet>   
                            <b:listLinks>
                                <ui:repeat value="#{readerBean.chapterList}" var="chapter">
                                    <b:navLink href="?chapter=#{chapter.number}" value="#{chapter.number} - #{chapter.title}" rendered="#{!(param['chapter'] == chapter.number)}"/>
                                    
                                    <b:panel rendered="#{(param['chapter'] == chapter.number)}">
                                        <b:navLink></b:navLink>
                                        <b:navLink header="#{chapter.number} - #{chapter.title}"/>
                                        <ui:repeat value="#{chapter.subsections}" var="subsection">
                                            <li>
                                                <a href="##{chapter.number}-#{subsection.number}">#{chapter.number}.#{subsection.number} - #{subsection.title}</a>
                                            </li>
                                        </ui:repeat>
                                        <b:navLink></b:navLink>
                                    </b:panel>
                                </ui:repeat>

                            </b:listLinks>
                         </b:panel>
                    </div>
                </td>
                
                <td width="75%" height="100%">
                    <div id="chapterTextFrame" style="overflow: auto; position: relative;">
                        <h:panelGroup rendered="#{userBean.loggedIn}">
                            <h:panelGroup rendered="#{(param['chapter'] == 5)}" style="height: 100%;">

                                <ui:include src="chapters/Chapter5-Better.xhtml"/>
                            </h:panelGroup>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{(param['chapter'] != null and !userBean.loggedIn)}">
                            <h2>You must  <a href="register.xhtml?redir=reader.xhtml%3Fchapter%3D#{param['chapter']}">register</a> or <a href="login.xhtml?redir=reader.xhtml%3Fchapter%3D#{param['chapter']}">login</a> before you can access this chapter.</h2>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{param['chapter'] == null}">
                            <img src="images/intro10eComprehensive.jpg" align="center"/>
                        </h:panelGroup>
                    </div>
                </td>
            </tr>
        </table>
    </h:body>
    <script language="javascript">
        
        var goToSubsection=function(subsectionUrl) {
            $("#textFrame").attr("src", subsectionUrl);
        };
        
        var resizeFrames = function() {
            $("#chapterFrame").height($(window).height() - 60);
            $("#chapterTextFrame").height($(window).height() - 60);
            
            $("#chapterTextFrame").position({ left: ($("#chapterFrame").width()+10), top: 60});
        };
        
        $(window).load(function() {
            resizeFrames();
            
            $(".subSectionLink").attr("target","chapterTextFrame");
        });
        
        $( window ).resize(function() {
            resizeFrames();
          });
          
          
          //<![CDATA[

    var chapterContents = $("#chapterFrame");
    var marginBar = $("#margin");

    var createMarginImages = function(elemClass, imgSrc, offsetTop, offsetLeft) {
        $(elemClass).each(function() {
                var kp = $(this);
                
                // Create a keypoint img
                var kpImg = $("<img/>", {
                        src: imgSrc
                });
                
                kpImg.appendTo(marginBar);
                kpImg.css({"position" : "absolute"});
                
                kpImg.offset({
                        top: kp.offset().top-offsetTop,
                        left: chapterContents.width()+offsetLeft
                });
        });
    };

    var createMarginItems = function() {
        
        var lastTop = 0;
        // Loop through all elements with the class 'keyTerm'
        
        $(".keyTerm").each(function() {
                
                var ktSpan = $(this);
                
                var ktText = ktSpan.text();
                
                if(ktText === "") {
                        ktText = ktSpan.attr("value");
                }
                
                // Create a new div and place it in the margin
                var ktDiv = $("<div/>", {
                        text: ktText
                });
                
                ktDiv.appendTo(marginBar);
                ktDiv.css({"position" : "absolute"});
                
                // Set the position of the new div to match that of the span
                var offsetTop = ktSpan.offset().top+2;
                
                // Simple check for overlapping terms. Only supports two terms being
                // on the same line.
                if(offsetTop == lastTop) {
                        offsetTop += 15;        
                }
                
                ktDiv.offset({
                        top: offsetTop,
                        left: chapterContents.width()+5
                });
                
                lastTop = offsetTop;
        });

        createMarginImages(".keyPoint", "chapters/keypoint.png", 10, 75);
        createMarginImages(".checkpoint", "chapters/checkpoint.png", 0, 75);
        createMarginImages(".outputBox", "chapters/laptop.png", -10, 85);
        createMarginImages(".traceBox", "chapters/search-icon.png", -10, 85);
        createMarginImages(".videoNote", "chapters/video-icon.png", 0, 85);
    };

    createMarginItems();

    //]]>
    </script>
</html>

